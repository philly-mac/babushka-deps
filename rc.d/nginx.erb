#!/bin/bash

. /etc/rc.conf
. /etc/rc.d/functions

DAEMON=nginx

case "$1" in
 start)
    stat_busy "Starting $DAEMON"
    pgrep nginx &>/dev/null
    [[ "$?" != "0" ]] && /opt/nginx/sbin/nginx
    sleep 1
    pgrep nginx &>/dev/null
    if [[ "$?" = "0" ]]; then
        add_daemon $DAEMON
        stat_done
    else
        stat_fail
        exit 1
    fi
    ;;
 stop)
    stat_busy "Stopping $DAEMON"
    pgrep nginx &>/dev/null
    [[ "$?" = "1" ]] && killall nginx &>/dev/null
    sleep 1
    pgrep nginx &>/dev/null
    if [[ "$?" != "0" ]]; then
      rm_daemon $DAEMON
      stat_done
    else
      stat_fail
      exit 1
    fi
    ;;
 restart)
    $0 stop
    sleep 1
    $0 start
    ;;
 *)
   echo "usage: $0 {start|stop|restart}"
esac