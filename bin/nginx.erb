#!/bin/bash

DAEMON=nginx

function check_process {
    pgrep nginx &>/dev/null
}

case "$1" in
 start)
    echo "Starting $DAEMON"
    check_process
    [[ "$?" != "0" ]] && /opt/nginx/sbin/nginx
    sleep 1
    check_process
    if [[ "$?" = "0" ]]; then
        echo "Started $DAEMON"
    else
        echo "Failed to start $DAEMON"
        exit 1
    fi
    ;;
 stop)
    echo "Stopping $DAEMON"
    check_process
    [[ "$?" = "0" ]] && kill `cat /opt/nginx/run/$DAEMON.pid` &>/dev/null
    sleep 1
    check_process
    if [[ "$?" != "0" ]]; then
      echo "Stopped $DAEMON"
    else
      echo "Failed to stop $DAEMON"
    fi
    ;;
 restart)
    $0 stop
    sleep 1
    $0 start
    ;;
 *)
   echo "usage: $0 {start|stop|restart}"
esac